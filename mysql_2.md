# MySQL, CRUD данных

Когда база данных создана и таблицы в ней созданы, когда все это сделано правильным пользователем с правильными правами и уровнем доступа, самое время заполнить таблицы данными. В работе с данными есть всего 4 действия: создание, получение, изменение и удаление данных. Для обозначения этих действий используется аббревиатура **CRUD: Create, Read, Update, Delete**.

Для экспериментов с данными нам понадобится таблица. К примеру, таблица слов из словаря:

```sql
mysql> DESC word;

+--------+--------------+------+-----+---------+----------------+
| Field  | Type         | Null | Key | Default | Extra          |
+--------+--------------+------+-----+---------+----------------+
| id     | int(11)      | NO   | PRI | NULL    | auto_increment |
| word   | varchar(100) | NO   |     |         |                |
| voc_id | int(11)      | NO   |     | 0       |                |
+--------+--------------+------+-----+---------+----------------+
3 rows in set (0.26 sec)
```

На всякий случай приведу команду создания этой таблицы:

```sql
CREATE TABLE `word` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `word` varchar(100) NOT NULL DEFAULT '',
  `voc_id` int(11) NOT NULL DEFAULT '0',
  PRIMARY KEY (`id`)
)
```

## CRUD данных - Create, добавление данных (INSERT)

Для добавления данных в таблицу используется оператор **`INSERT INTO`**. Оператор **`INSERT INTO`** бывает нескольких видов, и мы рассмотрим основные:

### Simple insert

Простейший вариант вставки данных в таблицу выглядит следующим образом:

```sql
INSERT INTO word SET word = "Earth", voc_id = 1;
```

В данном примере мы вставляем запись в таблицу word, указывая конкретное значение для каждого столбца в виде пары ключ-значение (key-value pair). Ключом выступает название поля, значением - собственно информацию, которую мы хотим поместить в записи в это поле.
Данный вид вставки данных применяется для добавления одной записи.

### Multiple insert

```sql
INSERT INTO word (word, voc_id) VALUES ("cat", 2), ("dog", 2), ("donkey", 2);
```
Код выше вставляет данные в последующих скобках в соответствующие столбцы, указанные в первых скобках. Таким образом, вначале необходимо перечислить столбцы (поля), в которые планируется вносить данные, а затем через запятую перечислить обернутые скобочками наборы данных для этих полей. Такой запрос позволяет добавлять несколько записей разом.

```sql
INSERT INTO word VALUES (30, "cat", 2), (31, "dog", 2), (32, "donkey", 2);

```
Данный вариант запроса  **`INSERT INTO`** используется, если вы планируете заполнять все столбцы, а не только выбранные.

### Insert from select

Возможна так же вставка данных из результата запроса:

```sql
INSERT INTO word (word) SELECT word FROM word;
```
Здесь приведен довольно простой пример, но, по сути дела, если вы построите запрос данных **`SELECT`** таким образом, чтобы количество столбцов в результате соответствовало необходимому, указанному во внешнем запросе **`INSERT`**, вы можете встроить запрос довольно серьезного уровня сложности.

## CRUD данных - Read, выборка данных (SELECT)

Запрос **`SELECT`** используется для получения данных, и никоим образом их не изменяет. Структура его довольно сложна, и мы попробуем разобрать ее постепенно. 

```sql
SELECT
    <field1>,
    <field2>,
    <field3>
    ...
FROM
    <table1>,
    <table2>,
    <view>,
    <temp_table>
    ...
WHERE
    <cond>
ORDER BY
    <поле1> ASC
    <поле2> DESC
LIMIT
    N,M
```


Ниже приведено текстовое описание основных элементов структуры запроса **`SELECT`**, более подробное описание с примерами будет приведено позже.

1. После ключевого слова **`SELECT`** идет перечень полей таблиц, функций, вычисляемых из этих полей, констант, независимых от записей функций. Для указания всех полей исопльзуется звездочка. Этот пункт является единственным обязательным пунктом в запросе **`SELECT`**, остальные опциональны.
2. Далее, после ключевого слова **`FROM`** следует перечень таблиц, представлений и временных таблиц, откуда ведется выборка. Таблицы могут быть просто перечислены, а могут быть присоединены к другим таблицам по описанным отдельно правилам, т.е. при помощи **`JOIN`**.


```sql
SELECT firtsname, lastname FROM authors;
SELECT * FROM books, articles;
```

3. Далее следует условие **`WHERE`**, пропускающее только те записи, которые удовлетворяют перечисленным в **`WHERE`** условиям. Все не прошедшие проверку записи отфильтровываются и не демонстрируются.
4. После фильтра **`WHERE`** может следовать группировка записей. 


```sql
SELECT * FROM books WHERE genre = 'non-fiction';
```

5. Группировка выполняется при помощи ключевых слов **`GROUP BY`**. Суть группировки в том, что записи могут объединяться по признаку или несольким признакам в одну запись, которая несет в себе некую общую для всех записей группы информацию или результат обработки информации по всей группе. Конструкция **`GROUP BY`** может включать в себя ключевое слово **`WHERE`**, позволяющее фильтровать результаты группировки.
5. После группировки может иметь место сортировка записей при помощи ключевых слов **`ORDER BY`**. При группировке указывается поле или перечень полей, по которому необходимо отсортировать, также можно указать направление сортировки. По умолчанию осуществляется сортировка по возрастанию.
6. 


В select в перечне таблиц можно использовать:

*

перечень полей

as

выражения

переменные (@varName:=colName with operation)


```sql
select count(*), word from word where id > 15 group by word having length(word) > 3 order by word limit 1, 2;
```



```sql
select * from word, vocabulary where word.voc_id = vocabulary.id;
+----+--------+--------+----+----------+
| id | word   | voc_id | id | name     |
+----+--------+--------+----+----------+
|  5 | donkey |      2 |  2 | Advanced |
|  6 | hello  |      3 |  3 | New      |
|  7 | Earth  |      3 |  3 | New      |
|  8 | cat    |      3 |  3 | New      |
|  9 | dog    |      3 |  3 | New      |
| 10 | donkey |      3 |  3 | New      |
| 13 | hello  |      1 |  1 | Basic    |
...
| 32 | donkey |      2 |  2 | Advanced |
+----+--------+--------+----+----------+
19 rows in set (0.00 sec)
```